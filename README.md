---

# **API Documentation**

---

## **üîë Authentication** 
Semua request harus pakai `apikey` di header:  
 ```http 
Authorization: Bearer YOUR_API_KEY (my supabase at .env or jwt_token login) 
apikey: YOUR_API_KEY (my supabase at .env) 
Content-Type: application/json ``` 

 > **Base URL:**  
 > `https://utvamweozojavcwqyzvc.supabase.co/rest/v1/`

---

## **üßë‚Äçüíª Users**

### **1Ô∏è‚É£ Register User**
**Endpoint:**  
```http
POST /auth/v1/signup
```
**Request Body:**  
```json
{
  "email": "user@example.com",
  "password": "password123",
  "options": {
    "data": {
      "username": "arshad",
      "full_name": "Arshad Cool"
    }
  }
```
**Response:**  
```json
{
  "user": {
    "id": "uuid",
    "email": "user@example.com",
    "created_at": "timestamp"
  },
  "session": {
    "access_token": "jwt_token",
    "expires_in": 3600
  }
}
```
**Notes:**  
- Registers a user via Supabase Auth and saves profile data (username, full_name) to the `profiles` table.

---

### **2Ô∏è‚É£ Login User (Get JWT Token)**
**Endpoint:**  
```http
POST /auth/v1/token?grant_type=password
```
**Request Body:**  
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```
**Response:**  
```json
{
  "access_token": "jwt_token",
  "expires_in": 3600,
  "token_type": "bearer",
  "refresh_token": "refresh_token",
  "user": {
    "id": "uuid",
   ctoolchain

---

### **3Ô∏è‚É£ Get User Profile**
**Endpoint:**  
```http
GET /profiles?id=eq.UUID_HERE
```
**Response:**  
```json
{
  "id": "uuid",
  "email": "user@example.com",
  "username": "arshad",
  "full_name": "Arshad Cool"
}
```

---

## **üí¨ Chat Sessions (Obrolan)**

### **4Ô∏è‚É£ Start New Chat**
**Endpoint:**  
```http
POST /obrolan
```
**Request Body:**  
```json
{
  "id": "uuid",
  "user_id": "uuid",
  "alias": "Chat Santuy"
}
```
**Response:**  
```json
{
  "id": "uuid",
  "user_id": "uuid",
  "alias": "Chat Santuy",
  "created_at": "timestamp"
}
```
**Notes:**  
- Chat ID is generated client-side using UUID. The `alias` can be auto-generated by AI based on the first message.

---

### **5Ô∏è‚É£ Get Chats by User**
**Endpoint:**  
```http
GET /obrolan?user_id=eq.UUID_HERE
```
**Response:**  
```json
[
  {
    "id": "uuid",
    "user_id": "uuid",
    "alias": "Chat Santuy",
    "created_at": "timestamp"
  }
]
```

---

### **6Ô∏è‚É£ Get Chat by ID**
**Endpoint:**  
```http
GET /obrolan?id=eq.UUID_HERE
```
**Response:**  
```json
{
  "id": "uuid",
  "user_id": "uuid",
  "alias": "Chat Santuy",
  "created_at": "timestamp"
}
```

---

## **üì© Messages (Pesan)**

### **7Ô∏è‚É£ Send Message**
**Endpoint:**  
```http
POST /pesan
```
**Request Body:**  
```json
{
  "chat_id": "uuid",
  "role": "user",
  "message": "Halo bro, apa kabar?",
  "timestamp": "2025-03-25T10:00:00Z"
}
```
**Response:**  
```json
{
  "id": "uuid",
  "chat_id": "uuid",
  "role": "user",
  "message": "Halo bro, apa kabar?",
  "sequence": 1,
  "timestamp": "2025-03-25T10:00:00Z"
}
```

---

### **8Ô∏è‚É£ Get Messages in a Chat**
**Endpoint:**  
```http
GET /pesan?chat_id=eq.UUID_HERE&order=sequence.asc
```
**Response:**  
```json
[
  {
    "id": "uuid",
    "chat_id": "uuid",
    "role": "user",
    "message": "Halo bro, apa kabar?",
    "sequence": 1,
    "timestamp": "2025-03-25T10:00:00Z"
  },
  {
    "id": "uuid",
    "chat_id": "uuid",
    "role": "assistant",
    "message": "Yo yo, kabar gw oke nih!",
    "sequence": 2,
    "timestamp": "2025-03-25T10:00:01Z"
  }
]
```

---

## **ü§ñ Chat Completion (Nurbahri AI)**

### **9Ô∏è‚É£ Generate Chat Response**
**Endpoint:**  
```http
POST /api/chat-completion
```
**Request Body:**  
```json
{
  "messages": [
    { "role": "user", "content": "Halo bro, apa kabar?" }
  ]
}
```
**Response:**  
```json
{
  "response": "Yo yo, kabar gw oke nih!"
}
```
**Notes:**  
- Powered by Google Gemini (model: `gemini-1.5-flash`).
- Prompts are processed to keep the language chill and santuy, with a custom persona "Nurbahri" that avoids formal bot vibes. If content is flagged, it responds with "Waduh gw gabisa jawabnya nih."
- Uses multiple API keys with automatic failover for reliability.

---

## **üî• Authentication (JWT)**
To secure endpoints, use Supabase Auth for JWT tokens.

### **Protecting Endpoints with Row Level Security (RLS)**
Enable RLS in Supabase to restrict access:  
```sql
ALTER TABLE obrolan ENABLE ROW LEVEL SECURITY;

CREATE POLICY "User can only access their own chats"
ON obrolan FOR SELECT USING (auth.uid() = user_id);

CREATE POLICY "User can only insert their own chats"
ON obrolan FOR INSERT WITH CHECK (auth.uid() = user_id);
```
**Notes:**  
- Ensures users only see or modify their own chats and messages.

---
